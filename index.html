<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Templify â€“ Dark Premium AI Template Generator</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#0b5fff;
      --muted:#aab0bd;

      /* DARK (transparent) */
      --bg:#050712;
      --panel:rgba(15,18,32,.55);
      --panel2:rgba(15,18,32,.35);
      --stroke:rgba(255,255,255,.10);
      --text:#f6f7fb;

      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
    }
    [data-theme="light"]{
      --bg:#f5f7ff;
      --panel:rgba(255,255,255,.72);
      --panel2:rgba(255,255,255,.55);
      --stroke:rgba(10,20,60,.12);
      --text:#0b1020;
      --shadow:0 18px 40px rgba(10,20,60,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(11,95,255,.22), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(136,71,255,.18), transparent 55%),
        radial-gradient(900px 600px at 35% 95%, rgba(0,225,255,.10), transparent 55%),
        var(--bg);
      overflow-x:hidden;
    }

    .wrap{max-width:1200px;margin:0 auto;padding:26px 18px 60px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border:1px solid var(--stroke);
      background:var(--panel);
      backdrop-filter: blur(16px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      position:sticky;top:14px;z-index:20;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background:linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.88));
      box-shadow:0 10px 26px rgba(11,95,255,.28);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand h1{font-size:15px;margin:0;font-weight:700;letter-spacing:.2px}
    .brand p{margin:0;color:var(--muted);font-size:12px}
    .actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--stroke);
      background:var(--panel2);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      font-weight:600;font-size:12.5px;
      cursor:pointer;transition:.15s ease;
      backdrop-filter: blur(16px);
      display:inline-flex;align-items:center;gap:8px;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(11,95,255,.35)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.85));
      border-color:rgba(255,255,255,.14);
      box-shadow:0 12px 30px rgba(11,95,255,.22);
    }
    .btn:active{transform:translateY(0px)}
    .tag{
      padding:6px 10px;border:1px solid var(--stroke);
      background:var(--panel2);
      border-radius:999px;font-size:12px;color:var(--muted)
    }

    main{margin-top:18px;display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    .card{
      border:1px solid var(--stroke);
      background:var(--panel);
      backdrop-filter: blur(16px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hero{padding:26px}
    .hero h2{margin:0 0 10px;font-size:34px;line-height:1.12}
    .hero p{margin:0 0 16px;color:var(--muted);font-size:14px;line-height:1.55}
    .grid{
      display:grid;grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;margin-top:18px
    }
    .tile{
      padding:14px;border:1px solid var(--stroke);
      background:var(--panel2);
      border-radius:16px;
      min-height:92px;
    }
    .tile b{display:block;font-size:12.5px;margin-bottom:6px}
    .tile span{font-size:12px;color:var(--muted);line-height:1.35}
    .right{padding:18px}
    .right h3{margin:2px 0 10px;font-size:14px}
    .field{margin:10px 0}
    .field label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    .field input,.field select,.field textarea{
      width:100%;padding:11px 12px;border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.10);
      color:var(--text);
      outline:none;
    }
    [data-theme="light"] .field input,
    [data-theme="light"] .field select,
    [data-theme="light"] .field textarea{
      background:rgba(255,255,255,.50);
    }
    textarea{min-height:96px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .foot{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:14px 18px;border-top:1px solid var(--stroke);
      color:var(--muted);font-size:12px
    }

    @media (max-width: 980px){
      main{grid-template-columns:1fr}
      .hero h2{font-size:28px}
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }
    @media (max-width: 520px){
      header{position:relative;top:auto}
      .grid{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
    }
  
    /* FIX: dropdown options visibility + borders */
    
    select{
      border:1px solid rgba(10,20,60,.45);
      background:#ffffff;
      color:#0b1020;
    }
    select option{
      color:#0b1020;
      background:#ffffff;
    }
    [data-theme="dark"] select{
      border:1px solid rgba(255,255,255,.25);
      background:#0b1020;
      color:#ffffff;
    }
    [data-theme="dark"] select option{
      color:#ffffff;
      background:#0b1020;
    }
    
    [data-theme="dark"] select option{color:#ffffff;background:#0b1020;}
    </style>
    
</head>

<body data-theme="dark">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Templify</h1>
          <p>Dark Premium AI Template Generator + Ultimate Editor v1</p>
        </div>
      </div>

      <div class="actions">
        <span class="tag">No auth â€¢ No subscriptions â€¢ Netlify-ready</span>
        <button class="btn" id="themeBtn" type="button">ðŸŒ— Toggle theme</button>
        <button class="btn primary" id="openEditor" type="button">Open Editor</button>
        <button class="btn" id="btnTemplates" type="button">ðŸ“š Library</button>
        <button class="btn" id="btnAnimate" type="button">ðŸŽ¬ Animate</button>

      </div>
    </header>

    <main>
      <section class="card hero">
        <h2>Create hundreds of premium templates in minutes.</h2>
        <p>
          Generate designs fast, then fineâ€‘tune in the editor with a Canvaâ€‘style workflow:
          layers, properties, snap grid, multiâ€‘select, duplicate, undo/redo, and autosave.
        </p>

        <div class="actions" style="margin-top:14px">
          <button class="btn primary" id="generateBtn" type="button">âš¡ Generate Templates</button>
        <button class="btn" id="newLayoutBtn" type="button">ðŸ§© New Layout</button>
        <button class="btn" id="newStyleBtn" type="button">ðŸŽ¨ New Style</button>

          <button class="btn" id="exportBtn" type="button">â¬‡ Export List (JSON)</button>
        </div>

        <div class="grid" id="previewGrid" aria-live="polite" style="margin-top:18px"></div>
      </section>

      <aside class="card right">
        <h3>Generation settings</h3>

        <div class="field">
          <label>Category</label>
          <select id="cat">
            <option>Instagram Post</option>
            <option>YouTube Thumbnail</option>
            <option>Flyer</option>
            <option>Business Card</option>
            <option>Logo</option>
            <option>Presentation Slide</option>
            <option>Resume</option>
            <option>Poster</option>
            <option>Story</option>
          </select>
        </div>

        <div class="row">
          <div class="field">
            <label>Count (max 200)</label>
            <input id="count" type="number" min="1" max="200" value="24" />
          </div>
          <div class="field">
            <label>Style</label>
            <select id="style">
              <option>Dark Premium</option>
              <option>Light Minimal</option>
              <option>Neon</option>
              <option>Glassmorphism</option>
              <option>Corporate</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>Prompt</label>
          <textarea id="prompt" placeholder="e.g., Premium real-estate carousel for luxury apartments, bold typography, modern shapes..."></textarea>
        </div>

        <div class="field">
          <label>Notes</label>
          <input id="notes" placeholder="(optional) brand name, colors, etc." />
        </div>

        <div class="foot">
          <span>Tip: Click any preview to open it in the Editor.</span>
          <span id="status">Ready</span>
        </div>
      </aside>
    </main>
  </div>
<script type="module">
import { layouts, styles, buildTemplates, RESIZE_PRESETS } from "./design.js";

const $ = (s)=>document.querySelector(s);
const grid = $("#previewGrid");
const statusEl = $("#status");

let currentLayout = layouts.find(l=>l.name==="Modern") || layouts[0];
let currentStyle  = styles.find(s=>s.name==="Dark Premium") || styles[0];

let lastGenerated = [];

function getMeta(){
  return {
    cat: $("#cat")?.value || "Instagram Post",
    style: $("#style")?.value || currentStyle.name,
    layout: currentLayout.name,
    count: Math.min(200, Math.max(1, parseInt($("#count")?.value || "24", 10))),
    prompt: $("#prompt")?.value?.trim() || "",
    notes: $("#notes")?.value?.trim() || ""
  };
}

function setStatus(t){ if(statusEl) statusEl.textContent = t; }

function openEditorWith(template, meta){
  localStorage.setItem("templify_draft", JSON.stringify({
    meta,
    template,
    createdAt: Date.now()
  }));
  window.location.href = "editor.html";
}

// --- Mini preview renderer (strong, Canva-like) ---
const PREVIEW_W = 260, PREVIEW_H = 150;
function el(tag, cls){ const n=document.createElement(tag); if(cls) n.className=cls; return n; }

function renderMiniPreview(t, meta){
  const wrap = el("div","miniPreview");
  wrap.style.width = PREVIEW_W+"px";
  wrap.style.height = PREVIEW_H+"px";
  wrap.style.borderRadius = "16px";
  wrap.style.overflow = "hidden";
  wrap.style.position = "relative";
  wrap.style.marginBottom = "10px";
  wrap.style.boxShadow = "0 20px 50px rgba(0,0,0,.45)";

  const styleName = (meta.style||"").toLowerCase();
  if(styleName.includes("neon")){
    wrap.style.background = "linear-gradient(135deg, #7c3aed, #0b5fff)";
  }else if(styleName.includes("light")){
    wrap.style.background = "rgba(255,255,255,.85)";
  }else{
    wrap.style.background = "linear-gradient(135deg, rgba(11,95,255,.30), rgba(0,0,0,.55))";
  }

  const sx = PREVIEW_W / (t?.canvas?.w || 980);
  const sy = PREVIEW_H / (t?.canvas?.h || 620);

  const elements = Array.isArray(t?.elements) ? t.elements : [];
  elements.slice(0, 10).forEach((e, idx)=>{
    const box = el("div","miniEl");
    const x = Number(e.x ?? 0), y = Number(e.y ?? 0), w = Number(e.w ?? 120), h = Number(e.h ?? 80);

    box.style.position = "absolute";
    box.style.left = Math.max(0, Math.min(PREVIEW_W-2, x*sx)) + "px";
    box.style.top  = Math.max(0, Math.min(PREVIEW_H-2, y*sy)) + "px";
    box.style.width  = Math.max(8, Math.min(PREVIEW_W, w*sx)) + "px";
    box.style.height = Math.max(8, Math.min(PREVIEW_H, h*sy)) + "px";
    box.style.borderRadius = "12px";

    const title = String(e.title||"").toLowerCase();
    const sub = String(e.sub||"").toLowerCase();
    const looksImage = title.includes("image") || sub.includes("image") || title.includes("photo") || sub.includes("photo");

    if(looksImage){
      box.style.backgroundImage = `url(https://source.unsplash.com/600x400/?${encodeURIComponent((meta.prompt||meta.cat||"business"))}&sig=${idx})`;
      box.style.backgroundSize="cover";
      box.style.backgroundPosition="center";
      box.style.border = "1px solid rgba(255,255,255,.16)";
      box.style.opacity = "0.95";
    }else{
      box.style.background = "rgba(11,95,255,.14)";
      box.style.border = "1px solid rgba(11,95,255,.22)";

      const line1 = el("div");
      line1.style.position="absolute";
      line1.style.left="10px";
      line1.style.top="10px";
      line1.style.height="10px";
      line1.style.width="85%";
      line1.style.borderRadius="999px";
      line1.style.background="rgba(255,255,255,.45)";

      const line2 = el("div");
      line2.style.position="absolute";
      line2.style.left="10px";
      line2.style.top="28px";
      line2.style.height="6px";
      line2.style.width="60%";
      line2.style.borderRadius="999px";
      line2.style.background="rgba(255,255,255,.22)";

      box.appendChild(line1); box.appendChild(line2);
    }

    wrap.appendChild(box);
  });

  const glow = el("div");
  glow.style.position="absolute";
  glow.style.inset="-40px";
  glow.style.background="radial-gradient(180px 120px at 30% 20%, rgba(11,95,255,.22), transparent 60%)";
  glow.style.pointerEvents="none";
  wrap.appendChild(glow);

  wrap.style.animation = "floaty 6s ease-in-out infinite";
  return wrap;
}

function renderTiles(list, meta){
  grid.innerHTML = "";
  list.forEach((t, i)=>{
    const div = document.createElement("div");
    div.className = "tile";
    div.tabIndex = 0;

    const title = t.title || `${meta.cat} #${i+1}`;
    const desc  = t.description || `${meta.style} â€¢ ${meta.layout} â€¢ Click to edit`;

    div.appendChild(renderMiniPreview(t, meta));

    const b = document.createElement("b"); b.textContent = title;
    const s = document.createElement("span"); s.textContent = desc;
    div.appendChild(b); div.appendChild(s);

    try{ currentStyle.applyTile?.(div); }catch(e){}
    try{ currentLayout.applyTile?.(div); }catch(e){}

    div.addEventListener("click", ()=>openEditorWith(t, meta));
    div.addEventListener("keydown",(e)=>{ if(e.key==="Enter") div.click(); });

    grid.appendChild(div);
  });
}

// Theme
function toggleTheme(){
  const body = document.body;
  const cur = body.getAttribute("data-theme") || "dark";
  const next = cur === "dark" ? "light" : "dark";
  body.setAttribute("data-theme", next);
  localStorage.setItem("templify_theme", next);
}
$("#themeBtn")?.addEventListener("click", toggleTheme);

// Sidebar buttons
$("#btnTemplates")?.addEventListener("click", ()=>alert("Templates Libraryâ€“ coming soon"));
$("#btnAnimate")?.addEventListener("click", ()=>alert("Animate â€“ coming soon"));

// New Layout / Style
$("#newLayoutBtn")?.addEventListener("click", ()=>{
  currentLayout = layouts[Math.floor(Math.random()*layouts.length)];
  setStatus(`Layout: ${currentLayout.name}`);
});
$("#newStyleBtn")?.addEventListener("click", ()=>{
  currentStyle = styles[Math.floor(Math.random()*styles.length)];
  if($("#style")) $("#style").value = currentStyle.name;
  setStatus(`Style: ${currentStyle.name}`);
});

// Open editor blank
$("#openEditor")?.addEventListener("click", ()=>{
  const meta = getMeta();
  const built = buildTemplates({count:1, category: meta.cat, styleName: meta.style, layoutName: meta.layout, prompt: meta.prompt, notes: meta.notes});
  openEditorWith(built.templates[0], meta);
});

// Export
$("#exportBtn")?.addEventListener("click", ()=>{
  const blob = new Blob([JSON.stringify({ templates: lastGenerated }, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "templify_templates.json";
  a.click();
  URL.revokeObjectURL(a.href);
});

// Generate: AI first, engine fallback
$("#generateBtn")?.addEventListener("click", async ()=>{
  const meta = getMeta();
  setStatus("Generatingâ€¦");
  try{
    const res = await fetch("/api/generate", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ category: meta.cat, style: meta.style, prompt: meta.prompt, notes: meta.notes, count: meta.count })
    });
    const data = await res.json();
    const arr = Array.isArray(data?.templates) ? data.templates : [];
    if(!arr.length) throw new Error("empty");

    lastGenerated = arr.map((t,i)=>({
      title: t.title || `${meta.cat} #${i+1}`,
      description: t.description || `${meta.style} â€¢ ${meta.layout}`,
      canvas: t.canvas || { w: 980, h: 620 },
      elements: Array.isArray(t.elements) ? t.elements.map(e=>({
        x: Number(e.x ?? 80),
        y: Number(e.y ?? 80),
        w: Number(e.w ?? 260),
        h: Number(e.h ?? 130),
        title: String(e.title ?? ""),
        sub: String(e.sub ?? "")
      })) : []
    }));

    renderTiles(lastGenerated, meta);
    setStatus(`Generated ${lastGenerated.length}`);
  }catch(err){
    const built = buildTemplates({count: meta.count, category: meta.cat, styleName: meta.style, layoutName: meta.layout, prompt: meta.prompt, notes: meta.notes});
    lastGenerated = built.templates;
    renderTiles(lastGenerated, meta);
    setStatus(`Generated ${lastGenerated.length} (engine)`);
  }
});

// Initial seed
(function init(){
  const savedTheme = localStorage.getItem("templify_theme");
  if(savedTheme==="light"||savedTheme==="dark") document.body.setAttribute("data-theme", savedTheme);

  const meta = getMeta();
  const built = buildTemplates({count: 12, category: meta.cat, styleName: meta.style, layoutName: meta.layout});
  lastGenerated = built.templates;
  renderTiles(lastGenerated, meta);
  setStatus("Ready");
})();
</script>

<style>
@keyframes floaty{
  0%{transform:translateY(0)}
  50%{transform:translateY(-4px)}
  100%{transform:translateY(0)}
}
</style>

</body>
</html>
