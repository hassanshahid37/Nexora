<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Templify â€“ Dark Premium AI Template Generator</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#0b5fff;
      --muted:#aab0bd;

      /* DARK (transparent) */
      --bg:#050712;
      --panel:rgba(15,18,32,.55);
      --panel2:rgba(15,18,32,.35);
      --stroke:rgba(255,255,255,.10);
      --text:#f6f7fb;

      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
    }
    [data-theme="light"]{
      --bg:#f5f7ff;
      --panel:rgba(255,255,255,.72);
      --panel2:rgba(255,255,255,.55);
      --stroke:rgba(10,20,60,.12);
      --text:#0b1020;
      --shadow:0 18px 40px rgba(10,20,60,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(11,95,255,.22), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(136,71,255,.18), transparent 55%),
        radial-gradient(900px 600px at 35% 95%, rgba(0,225,255,.10), transparent 55%),
        var(--bg);
      overflow-x:hidden;
    }

    .wrap{max-width:1200px;margin:0 auto;padding:26px 18px 60px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border:1px solid var(--stroke);
      background:var(--panel);
      backdrop-filter: blur(16px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      position:sticky;top:14px;z-index:20;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background:linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.88));
      box-shadow:0 10px 26px rgba(11,95,255,.28);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand h1{font-size:15px;margin:0;font-weight:700;letter-spacing:.2px}
    .brand p{margin:0;color:var(--muted);font-size:12px}
    .actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--stroke);
      background:var(--panel2);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      font-weight:600;font-size:12.5px;
      cursor:pointer;transition:.15s ease;
      backdrop-filter: blur(16px);
      display:inline-flex;align-items:center;gap:8px;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(11,95,255,.35)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.85));
      border-color:rgba(255,255,255,.14);
      box-shadow:0 12px 30px rgba(11,95,255,.22);
    }
    .btn:active{transform:translateY(0px)}
    .tag{
      padding:6px 10px;border:1px solid var(--stroke);
      background:var(--panel2);
      border-radius:999px;font-size:12px;color:var(--muted)
    }

    main{margin-top:18px;display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    .card{
      border:1px solid var(--stroke);
      background:var(--panel);
      backdrop-filter: blur(16px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hero{padding:26px}
    .hero h2{margin:0 0 10px;font-size:34px;line-height:1.12}
    .hero p{margin:0 0 16px;color:var(--muted);font-size:14px;line-height:1.55}
    .grid{
      display:grid;grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;margin-top:18px
    }
    .tile{
      padding:14px;border:1px solid var(--stroke);
      background:var(--panel2);
      border-radius:16px;
      min-height:92px;
      position:relative;
      overflow:hidden;
    }
    .thumb{
      height:84px;
      border-radius:12px;
      margin-bottom:10px;
      position:relative;
      background:
        radial-gradient(160px 80px at 20% 20%, rgba(11,95,255,.24), transparent 60%),
        radial-gradient(140px 90px at 90% 35%, rgba(136,71,255,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.14);
    }
    [data-theme="light"] .thumb{
      background:
        radial-gradient(160px 80px at 20% 20%, rgba(11,95,255,.14), transparent 60%),
        radial-gradient(140px 90px at 90% 35%, rgba(136,71,255,.10), transparent 60%),
        linear-gradient(135deg, rgba(10,20,60,.06), rgba(10,20,60,.02));
      border:1px solid rgba(10,20,60,.12);
    }
    .mini{
      position:absolute;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.10);
    }
    [data-theme="light"] .mini{
      border:1px solid rgba(10,20,60,.12);
      background:rgba(10,20,60,.06);
    }
    .tile b{display:block;font-size:12.5px;margin-bottom:6px}
    .tile span{font-size:12px;color:var(--muted);line-height:1.35}
    .right{padding:18px}
    .right h3{margin:2px 0 10px;font-size:14px}
    .field{margin:10px 0}
    .field label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    .field input,.field select,.field textarea{
      width:100%;padding:11px 12px;border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.10);
      color:var(--text);
      outline:none;
    }
    [data-theme="light"] .field input,
    [data-theme="light"] .field select,
    [data-theme="light"] .field textarea{
      background:rgba(255,255,255,.50);
    }
    textarea{min-height:96px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .foot{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:14px 18px;border-top:1px solid var(--stroke);
      color:var(--muted);font-size:12px
    }

    @media (max-width: 980px){
      main{grid-template-columns:1fr}
      .hero h2{font-size:28px}
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }
    @media (max-width: 520px){
      header{position:relative;top:auto}
      .grid{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
    }
  
    /* FIX: dropdown options visibility + borders */
    
    select{
      border:1px solid rgba(10,20,60,.45);
      background:#ffffff;
      color:#0b1020;
    }
    select option{
      color:#0b1020;
      background:#ffffff;
    }
    [data-theme="dark"] select{
      border:1px solid rgba(255,255,255,.25);
      background:#0b1020;
      color:#ffffff;
    }
    [data-theme="dark"] select option{
      color:#ffffff;
      background:#0b1020;
    }
    
    [data-theme="dark"] select option{color:#ffffff;background:#0b1020;}
    
/* === Nexora Canva-style previews === */
.tile .preview-canvas{
  position: relative;
  height: 120px;
  border-radius: 14px;
  overflow: hidden;
  background: rgba(255,255,255,.06);
  border: 1px solid var(--stroke);
  margin-bottom: 10px;
}
.tile .preview-canvas .pv-text{
  position:absolute;
  left:12px;
  right:12px;
  font-weight:700;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}


/* === Canva-style DOM thumbnail renderer === */
.thumb{ overflow:hidden; }
.thumb .pv-overlay{
  position:absolute; inset:0;
  background:
    radial-gradient(180px 120px at 20% 15%, rgba(255,255,255,.16), transparent 60%),
    radial-gradient(240px 160px at 85% 30%, rgba(0,0,0,.18), transparent 65%),
    linear-gradient(180deg, rgba(0,0,0,.14), rgba(0,0,0,.02));
  pointer-events:none;
}
[data-theme="light"] .thumb .pv-overlay{
  background:
    radial-gradient(180px 120px at 20% 15%, rgba(255,255,255,.72), transparent 60%),
    radial-gradient(240px 160px at 85% 30%, rgba(10,20,60,.10), transparent 65%),
    linear-gradient(180deg, rgba(10,20,60,.06), rgba(10,20,60,.00));
}

.thumb .pv-el{
  position:absolute;
  box-sizing:border-box;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.10);
  backdrop-filter: blur(8px);
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
  padding: 0;
}
[data-theme="light"] .thumb .pv-el{
  border:1px solid rgba(10,20,60,.10);
  background: rgba(255,255,255,.70);
}

.thumb .pv-img{
  background:
    radial-gradient(160px 120px at 30% 20%, rgba(255,255,255,.18), transparent 60%),
    linear-gradient(135deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.16);
}
[data-theme="light"] .thumb .pv-img{
  background:
    radial-gradient(160px 120px at 30% 20%, rgba(11,95,255,.10), transparent 60%),
    linear-gradient(135deg, rgba(10,20,60,.06), rgba(10,20,60,.02));
  border:1px solid rgba(10,20,60,.12);
}

.thumb .pv-shape{
  backdrop-filter: blur(10px);
}

.thumb .pv-title, .thumb .pv-sub{
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
}

.thumb .pv-shine{
  position:absolute;
  width:140px; height:140px;
  right:-40px; top:-40px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), transparent 60%);
  transform: rotate(12deg);
  pointer-events:none;
  mix-blend-mode: overlay;
}
[data-theme="light"] .thumb .pv-shine{
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.60), transparent 60%);
  mix-blend-mode: normal;
}

</style>
    
</head>

<body data-theme="dark">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Templify</h1>
          <p>Dark Premium AI Template Generator + Ultimate Editor v1</p>
        </div>
      </div>

      <div class="actions">
        <span class="tag">No auth â€¢ No subscriptions â€¢ Netlify-ready</span>
        <button class="btn" id="themeBtn" type="button">ðŸŒ— Toggle theme</button>
        <button class="btn primary" id="openEditor" type="button">Open Editor</button>
        <button class="btn" id="btnTemplates" type="button">ðŸ“š Library</button>
        <button class="btn" id="btnAnimate" type="button">ðŸŽ¬ Animate</button>

      </div>
    </header>

    <main>
      <section class="card hero">
        <h2>Create hundreds of premium templates in minutes.</h2>
        <p>
          Generate designs fast, then fineâ€‘tune in the editor with a Canvaâ€‘style workflow:
          layers, properties, snap grid, multiâ€‘select, duplicate, undo/redo, and autosave.
        </p>

        <div class="actions" style="margin-top:14px">
          <button class="btn primary" id="generateBtn" type="button">âš¡ Generate Templates</button>
        <button class="btn" id="newLayoutBtn" type="button">ðŸ§© New Layout</button>
        <button class="btn" id="newStyleBtn" type="button">ðŸŽ¨ New Style</button>

          <button class="btn" id="exportBtn" type="button">â¬‡ Export List (JSON)</button>
        </div>

        <div class="grid" id="previewGrid" aria-live="polite" style="margin-top:18px"></div>
      </section>

      <aside class="card right">
        <h3>Generation settings</h3>

        <div class="field">
          <label>Category</label>
          <select id="cat">
            <option>Instagram Post</option>
            <option>YouTube Thumbnail</option>
            <option>Flyer</option>
            <option>Business Card</option>
            <option>Logo</option>
            <option>Presentation Slide</option>
            <option>Resume</option>
            <option>Poster</option>
            <option>Story</option>
          </select>
        </div>

        <div class="row">
          <div class="field">
            <label>Count (max 200)</label>
            <input id="count" type="number" min="1" max="200" value="24" />
          </div>
          <div class="field">
            <label>Style</label>
            <select id="style">
              <option>Dark Premium</option>
              <option>Light Minimal</option>
              <option>Neon</option>
              <option>Glassmorphism</option>
              <option>Corporate</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>Prompt</label>
          <textarea id="prompt" placeholder="e.g., Premium real-estate carousel for luxury apartments, bold typography, modern shapes..."></textarea>
        </div>

        <div class="field">
          <label>Notes</label>
          <input id="notes" placeholder="(optional) brand name, colors, etc." />
        </div>

        <div class="foot">
          <span>Tip: Click any preview to open it in the Editor.</span>
          <span id="status">Ready</span>
        </div>
      </aside>
    </main>
  </div>

<script>
  const $ = (s)=>document.querySelector(s);
  const grid = $("#previewGrid");
  const statusEl = $("#status");

  function setTheme(next){
    document.body.setAttribute("data-theme", next);
    localStorage.setItem("templify_theme", next);
  }
  function toggleTheme(){
    const cur = document.body.getAttribute("data-theme") || "dark";
    setTheme(cur === "dark" ? "light" : "dark");
  }

  function drawThumb(thumb, elements, bg){
    if(!thumb) return;
    thumb.innerHTML = "";

    // --- Canva-style thumbnail renderer (safe, DOM-based) ---
    // Background
    let bgCss = bg || null;
    if(!bgCss && Array.isArray(elements)){
      const bgEl = elements.find(e => String(e.type||"").toLowerCase()==="background");
      bgCss = bgEl?.fill || bgEl?.background || null;
    }
    if(bgCss){
      if(String(bgCss).includes("gradient")){
        thumb.style.backgroundImage = String(bgCss);
        thumb.style.backgroundColor = "";
      }else{
        thumb.style.backgroundImage = "";
        thumb.style.backgroundColor = String(bgCss);
      }
    }

    // Overlay for depth
    const overlay = document.createElement("div");
    overlay.className = "pv-overlay";
    thumb.appendChild(overlay);

    const W0 = 980, H0 = 620;
    const sx = thumb.clientWidth / W0;
    const sy = thumb.clientHeight / H0;

    const clamp = (n, a, b)=> Math.max(a, Math.min(b, n));
    const pickFirst = (types)=> (Array.isArray(elements) ? elements.find(e => types.includes(String(e.type||"").toLowerCase())) : null);

    const isLightTheme = (document.body.getAttribute("data-theme") === "light");
    const ink = isLightTheme ? "rgba(10,20,60,.92)" : "rgba(255,255,255,.92)";
    const inkSoft = isLightTheme ? "rgba(10,20,60,.70)" : "rgba(255,255,255,.74)";
    const shadow = isLightTheme ? "0 10px 24px rgba(10,20,60,.12)" : "0 14px 32px rgba(0,0,0,.35)";

    function addBlock({x,y,w,h,cls,style={},text=null}){
      const d = document.createElement("div");
      d.className = "pv-el " + (cls||"");
      d.style.left = (clamp(Number(x||0)*sx, 0, thumb.clientWidth-2)) + "px";
      d.style.top  = (clamp(Number(y||0)*sy, 0, thumb.clientHeight-2)) + "px";
      d.style.width  = (clamp(Number(w||80)*sx, 10, thumb.clientWidth)) + "px";
      d.style.height = (clamp(Number(h||22)*sy, 8, thumb.clientHeight)) + "px";
      d.style.boxShadow = shadow;

      for(const [k,v] of Object.entries(style||{})){
        d.style[k] = v;
      }

      if(text){
        d.textContent = text;
      }
      thumb.appendChild(d);
      return d;
    }

    // Image / hero block
    const img = pickFirst(["image"]);
    if(img){
      addBlock({
        x: img.x, y: img.y, w: img.w || img.width, h: img.h || img.height,
        cls: "pv-img",
      });
    }

    // Shapes / cards (1â€“2 max for cleanliness)
    const shapes = (Array.isArray(elements) ? elements.filter(e => ["shape","card"].includes(String(e.type||"").toLowerCase())) : []).slice(0,2);
    shapes.forEach((s, idx)=>{
      addBlock({
        x: s.x, y: s.y, w: s.w || s.width, h: s.h || s.height,
        cls: "pv-shape",
        style: {
          opacity: String(s.opacity ?? 1),
          borderRadius: ((Number(s.radius)||18) * Math.min(sx,sy)) + "px",
          background: String(s.background || s.fill || (idx===0 ? "rgba(255,255,255,.12)" : "rgba(255,255,255,.08)")),
          border: isLightTheme ? "1px solid rgba(10,20,60,.10)" : "1px solid rgba(255,255,255,.16)"
        }
      });
    });

    // Badge
    const badge = pickFirst(["badge"]);
    if(badge){
      addBlock({
        x: badge.x, y: badge.y, w: badge.w || badge.width || 220, h: badge.h || badge.height || 54,
        cls: "pv-badge",
        text: (badge.title || "FEATURED").toString().slice(0,18),
        style: {
          borderRadius: "999px",
          background: String(badge.background || "rgba(255,255,255,.16)"),
          color: String(badge.color || ink),
          fontWeight: "800",
          fontSize: clamp((Number(badge.fontSize||14) * Math.min(sx,sy)), 10, 14) + "px",
          letterSpacing: ".4px",
          display:"flex",
          alignItems:"center",
          justifyContent:"center",
          padding:"0 10px",
          textTransform:"uppercase"
        }
      });
    }

    // Heading + supporting text
    const heading = pickFirst(["heading"]);
    if(heading){
      addBlock({
        x: heading.x, y: heading.y, w: heading.w || hookup(heading,"width",740), h: heading.h || hookup(heading,"height",120),
        cls: "pv-title",
        text: (heading.title || heading.text || "Headline").toString(),
        style: {
          background: "transparent",
          border: "none",
          boxShadow: "none",
          color: String(heading.color || ink),
          fontWeight: String(heading.fontWeight || 800),
          fontSize: clamp((Number(heading.fontSize||34) * Math.min(sx,sy)), 13, 18) + "px",
          lineHeight: "1.05",
          textShadow: isLightTheme ? "none" : "0 10px 26px rgba(0,0,0,.35)",
          padding: "0"
        }
      });
    }

    const sub = pickFirst(["subhead","text"]);
    if(sub){
      addBlock({
        x: sub.x, y: sub.y, w: sub.w || sub.width || 520, h: sub.h || sub.height || 70,
        cls: "pv-sub",
        text: (sub.title || sub.sub || sub.text || "").toString().replace(/
/g," â€¢ ").slice(0,60),
        style: {
          background: "transparent",
          border: "none",
          boxShadow: "none",
          color: String(sub.color || inkSoft),
          fontWeight: String(sub.fontWeight || 600),
          fontSize: clamp((Number(sub.fontSize||16) * Math.min(sx,sy)), 10, 12) + "px",
          lineHeight: "1.25",
          padding: "0"
        }
      });
    }

    // CTA
    const cta = pickFirst(["cta"]);
    if(cta){
      addBlock({
        x: cta.x, y: cta.y, w: cta.w || cta.width || 240, h: cta.h || cta.height || 64,
        cls: "pv-cta",
        text: (cta.title || "Get Started").toString().slice(0,18),
        style: {
          borderRadius: ((Number(cta.radius)||18) * Math.min(sx,sy)) + "px",
          background: String(cta.background || "linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.85))"),
          color: String(cta.color || "#fff"),
          fontWeight: "800",
          fontSize: clamp((Number(cta.fontSize||14) * Math.min(sx,sy)), 10, 12) + "px",
          display:"flex",
          alignItems:"center",
          justifyContent:"center",
          border: "1px solid rgba(255,255,255,.14)"
        }
      });
    }

    // small highlight corner
    const shine = document.createElement("div");
    shine.className = "pv-shine";
    thumb.appendChild(shine);

    function hookup(obj, key, d){
      // helper to avoid NaN if missing
      const v = obj?.[key];
      return (typeof v === "number" && Number.isFinite(v)) ? v : d;
    }
  }


  function seedTemplates(n){
    grid.innerHTML = "";
    __lastTemplates = [];
    const category = $("#cat").value;
    const style = $("#style").value;

    // Simple "real" layouts for the editor (cards on canvas)
    const patterns = [
      // Hero + CTA
      (i)=> ([
        { type: "heading", x: 80, y: 70,  w: 820, h: 120, title: "Grow Your Brand", sub: "" },
        { type: "text", x: 80, y: 210, w: 620, h: 110, title: "",  sub: "Premium design with clear hierarchy and focus." },
        { type: "cta", x: 80, y: 350, w: 360, h: 110, title: "Shop Now", sub: "" },
        { type: "image", x: 520,y: 260, w: 380, h: 300, title: "", sub: "" },
      ]),
      // Split left text / right image
      (i)=> ([
        { type: "heading", x: 70, y: 80,  w: 420, h: 150, title: "New Collection", sub: "" },
        { type: "text", x: 70, y: 250, w: 420, h: 170, title: "",  sub: "â€¢ Premium quality\nâ€¢ Fast delivery\nâ€¢ Limited offer" },
        { type: "image", x: 520,y: 80,  w: 390, h: 360, title: "", sub: "" },
      ]),
      // Badge + centered headline
      (i)=> ([
        { type: "badge", x: 320,y: 70,  w: 320, h: 70,  title: "LIMITED", sub: "" },
        { type: "heading", x: 160,y: 190, w: 660, h: 150, title: "Flash Sale", sub: "" },
        { type: "cta", x: 250,y: 390, w: 480, h: 90, title: "Get 30% Off", sub: "" },
      ]),
    ];

    for(let i=1;i<=n;i++){
      const div = document.createElement("div");
      div.className = "tile";
      div.tabIndex = 0;

      const layoutWord = ["Bold","Clean","Modern","Vibrant","Minimal"][i%5];
      div.innerHTML = `
        <div class="thumb" aria-hidden="true"></div>
        <b>${category} #${i}</b>
        <span>${style} â€¢ ${layoutWord} layout â€¢ Click to edit</span>
      `;

      const elements = patterns[i % patterns.length](i).map(e => ({ id: (globalThis.crypto?.randomUUID?.() || (Math.random().toString(16).slice(2) + Date.now().toString(16))), ...e }));

      const thumb = div.querySelector('.thumb');
      if(thumb){
        drawThumb(thumb, elements);
      }

      const template = {
        id: `seed_${Date.now()}_${i}`,
        title: `${category} #${i}`,
        description: `${style} â€¢ ${layoutWord} layout`,
        category,
        style,
        canvas: { w: 980, h: 620 },
        elements
      };
      __lastTemplates.push(template);

      div.addEventListener("click", ()=>openEditorWith(template));
      div.addEventListener("keydown",(e)=>{ if(e.key==="Enter") openEditorWith(template); });
      grid.appendChild(div);
    }
  }

  function openEditorWith(payload){
    // payload can be {cat,style,i} OR a full template object
    const cat = payload?.category || payload?.cat || $("#cat").value;
    const style = payload?.style || $("#style").value;

    // Store draft so editor can load a REAL template (elements/positions)
    localStorage.setItem("templify_draft", JSON.stringify({
      meta: {
        cat,
        style,
        i: payload?.i || 1,
        prompt: $("#prompt").value.trim(),
        notes: $("#notes").value.trim(),
        title: payload?.title || null,
        description: payload?.description || payload?.subtitle || null,
      },
      template: payload?.elements ? payload : null,
      createdAt: Date.now()
    }));
    window.location.href = "editor.html";
  }

  // Keep latest generated templates (for tile click -> editor)
  let __lastTemplates = [];

  $("#openEditor").addEventListener("click", ()=>openEditorWith({cat:$("#cat").value, style:$("#style").value, i:1}));
  $("#themeBtn").addEventListener("click", toggleTheme);

  $("#exportBtn").addEventListener("click", ()=>{
    const items = [...grid.children].map((el, idx)=>({
      title: el.querySelector("b")?.textContent || `Template #${idx+1}`,
      desc: el.querySelector("span")?.textContent || ""
    }));
    const blob = new Blob([JSON.stringify({items}, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "templify_templates.json";
    a.click();
    URL.revokeObjectURL(a.href);
  });

  // restore theme + initial previews
  const saved = localStorage.getItem("templify_theme");
  if(saved==="light"||saved==="dark") setTheme(saved);
  seedTemplates(12);
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("generateBtn");
  if (!btn) {
    alert("Generate button not found. UI mismatch.");
    return;
  }

  btn.addEventListener("click", async (event) => {
currentLayout = "Modern";
currentStyle = "Dark Premium";

    const payload = {
      category: document.getElementById("cat")?.value || "Instagram Post",
      style: document.getElementById("style")?.value || "Dark Premium",
      count: parseInt(document.getElementById("count")?.value || "10", 10),
      prompt: document.getElementById("prompt")?.value || "",
      notes: document.getElementById("notes")?.value || ""
    };

    try {
      const res = await fetch("/api/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      console.log("AI RESPONSE:", data);

      // âœ… MINIMAL FIX: connect AI result to the existing renderer
      // Render AI templates into the grid
      const templates = Array.isArray(data?.templates) ? data.templates : [];
      grid.innerHTML = "";
      const cat = payload.category;
      const style = payload.style;

      // Normalize templates to our editor-friendly schema
      const normalized = (templates.length ? templates : []).map((t, i) => {
        const elements = Array.isArray(t.elements) ? t.elements : [];
        return {
          id: t.id || `ai_${Date.now()}_${i+1}`,
          title: t.title || `${cat} #${i+1}`,
          description: t.description || t.subtitle || `${style} â€¢ AI generated`,
          category: t.category || payload.category || cat,
          style: t.style || payload.style || style,
          canvas: t.canvas || { w: 980, h: 620 },
          elements: elements.map(e => ({
            id: e.id || (crypto?.randomUUID?.() || (Math.random().toString(16).slice(2)+Date.now().toString(16))),
            x: Number(e.x ?? 80), y: Number(e.y ?? 80),
            w: Number(e.w ?? e.width ?? 420), h: Number(e.h ?? e.height ?? 120),
            title: String(e.title ?? "TEXT"), sub: String(e.sub ?? e.text ?? "")
          }))
        };
      });

      // If AI returned nothing usable, fall back to seeded "real" templates
      if(!normalized.length){
        seedTemplates(payload.count);
        statusEl.textContent = `Generated ${payload.count}`;
        return;
      }

      __lastTemplates = normalized;
      grid.innerHTML = "";

      __lastTemplates.forEach((t) => {
        const div = document.createElement("div");
        div.className = "tile";
        div.tabIndex = 0;
        div.innerHTML = `<div class="thumb" aria-hidden="true"></div><b>${t.title}</b><span>${t.description}</span>`;

      const thumb = div.querySelector('.thumb');
      if(thumb){
        drawThumb(thumb, t.elements, t.bg);
      }

        div.addEventListener("click", ()=>openEditorWith(t));
        div.addEventListener("keydown",(e)=>{ if(e.key==="Enter") openEditorWith(t); });
        grid.appendChild(div);
      });

      statusEl.textContent = `Generated ${__lastTemplates.length}`;
    } catch (e) {
      // âœ… Fallback: never leave user with "nothing happened"
      seedTemplates(payload.count);
    }
  });
});
</script>
<script>
  document.getElementById("btnTemplates")?.addEventListener("click", () => {
    alert("Templates Libraryâ€“ coming soon");
  });

  document.getElementById("btnAnimate")?.addEventListener("click", () => {
    alert("Animate â€“ coming soon");
  });
</script>

<script type="module">
// Nexora: New Layout + New Style (SAFE)
// UI unchanged. Only updates the preview tile text.

const layouts = ["Bold","Clean","Modern","Minimal","Vibrant"];
const styles  = ["Dark Premium","Light Minimal","Neon","Glassmorphism","Corporate"];

const grid = document.getElementById("previewGrid");
const statusEl = document.getElementById("status");

function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function setStatus(msg){ if(statusEl) statusEl.textContent = msg; }

function updateTilesText({layout=null, style=null}={}){
  if(!grid) return;
  const tiles = Array.from(grid.querySelectorAll(".tile"));
  tiles.forEach((tile) => {
    const span = tile.querySelector("span");
    if(!span) return;
    const curStyle = style || (document.getElementById("style")?.value) || "Dark Premium";
    const curLayout = layout || span.textContent.match(/\b(Bold|Clean|Modern|Minimal|Vibrant)\b/)?.[0] || "Modern";
    span.textContent = `${curStyle} â€¢ ${curLayout} layout â€¢ Click to edit`;
  });
}

document.getElementById("newLayoutBtn")?.addEventListener("click", () => {
  updateTilesText({ layout: pick(layouts) });
  setStatus("New layout applied");
});

document.getElementById("newStyleBtn")?.addEventListener("click", () => {
  const s = pick(styles);
  const sel = document.getElementById("style");
  if(sel){
    const opt = Array.from(sel.options).find(o => o.textContent.trim() === s);
    if(opt) sel.value = opt.textContent.trim();
  }
  updateTilesText({ style: s });
  setStatus("New style applied");
});

</script>


<script>
function renderPreview(canvas, t){
  if(!canvas) return;
  canvas.innerHTML="";
  if(t.bg) canvas.style.background=t.bg;
  const texts=(t.elements||[]).filter(e=>e.type==="heading"||e.type==="text").slice(0,2);
  texts.forEach((e,i)=>{
    const d=document.createElement("div");
    d.className="pv-text";
    d.textContent=e.title||"";
    d.style.top=(14+i*32)+"px";
    d.style.fontSize=(i===0?16:12)+"px";
    d.style.color=e.color||"#fff";
    canvas.appendChild(d);
  });
}
</script>

</body>
</html>
